# å…¨å±€ä¿¡æ¯è¿‡æ»¤æŒ‡å—

## ğŸ“š ä¿¡æ¯å±‚çº§åˆ†ç±»

### 1. å…¨å±€ä¿¡æ¯ (Global Information)
ä¿ç•™ âœ… - æè¿°æ•´ä½“ç»“æ„ç‰¹å¾

- **æ™¶ä½“ç»“æ„ç±»å‹**: "Halite", "Zincblende", "Laves-derived"
- **ç©ºé—´ç¾¤**: "F-43m", "Fm-3m", "Pm-3m"
- **æ™¶ç³»**: "cubic", "orthorhombic", "trigonal"
- **è¡ç”Ÿç»“æ„**: "beta Vanadium nitride-derived", "Cubic Laves-derived"
- **ç»´åº¦**: "one-dimensional", "zero-dimensional"

### 2. åŠå…¨å±€ä¿¡æ¯ (Semi-Global Information)
ä¿ç•™ âœ… - æè¿°é…ä½å’Œè¿æ¥æ€§

- **é…ä½å‡ ä½•**: "octahedral", "tetrahedral", "12-coordinate geometry"
- **æˆé”®æ‹“æ‰‘**: "corner-sharing", "edge-sharing", "face-sharing"
- **åŸå­è¿æ¥**: "bonded to six atoms", "bonded to three equivalent atoms"
- **ç»“æ„ç»„æˆ**: "consists of clusters", "framework structure"

### 3. å±€éƒ¨ä¿¡æ¯ (Local Information)
å»é™¤ âŒ - å…·ä½“çš„æ•°å€¼ç»†èŠ‚

- **é”®é•¿æ•°å€¼**: "2.48 Ã…", "3.60 Ã…", "bond lengths are 4.25 Ã…"
- **é”®è§’æ•°å€¼**: "40-54Â°", "tilt angles range from 10-12Â°"
- **å…·ä½“æ•°é‡**: "three shorter", "four longer"
- **ç²¾ç¡®è·ç¦»**: "All Ba(1)-Hf(1) bond lengths are 4.25 Ã…"

---

## ğŸ¯ ä¸ºä»€ä¹ˆè¦è¿‡æ»¤å±€éƒ¨ä¿¡æ¯ï¼Ÿ

### å¯¹äºæ³¨æ„åŠ›å¯è§£é‡Šæ€§åˆ†æï¼š

1. **å‡å°‘å™ªéŸ³**
   - å…·ä½“é”®é•¿æ•°å€¼ï¼ˆå¦‚ "2.48 Ã…"ï¼‰å¯¹ç†è§£æ•´ä½“ç»“æ„æ„ä¹‰ä¸å¤§
   - æ¨¡å‹åº”å…³æ³¨"tetrahedral"è€Œé"2.48"è¿™ä¸ªæ•°å­—

2. **æå‡å…¨å±€ç†è§£**
   - å¼ºè°ƒç»“æ„ç±»å‹ã€ç©ºé—´ç¾¤ç­‰å…¨å±€ç‰¹å¾
   - å¸®åŠ©æ¨¡å‹å­¦ä¹ ææ–™çš„æ•´ä½“æ€§è´¨

3. **è¿‡æ»¤æ— å…³æ•°å€¼**
   - æ•°å€¼tokenï¼ˆå¦‚"2.48", "Ã…"ï¼‰å¯èƒ½è·å¾—ä¸åº”æœ‰çš„æ³¨æ„åŠ›
   - ç±»ä¼¼äºåŠŸèƒ½è¯ï¼ˆ"the", "in"ï¼‰ï¼Œä½†æ›´éš¾è¯†åˆ«

4. **ä¸Middle FusionååŒ**
   - Middle Fusionè¿‡æ»¤åŠŸèƒ½è¯ï¼ˆthe, in, aï¼‰
   - ä¿¡æ¯è¿‡æ»¤å»é™¤æ— å…³æ•°å€¼
   - åŒé‡è¿‡æ»¤ â†’ æ›´æ¸…æ™°çš„æ³¨æ„åŠ›

---

## ğŸ“Š ä¸‰ç§è¿‡æ»¤æ¨¡å¼

### æ¨¡å¼ A: Aggressive (æ¿€è¿›)
**å»é™¤**: æ‰€æœ‰åŒ…å«é”®é•¿ã€é”®è§’çš„å¥å­

```
åŸå§‹:
"Ba(1) is bonded to six equivalent Ba(1) and three equivalent Hf(1) atoms.
There are three shorter (3.60 Ã…) and three longer (3.66 Ã…) Ba(1)-Ba(1) bond
lengths. All Ba(1)-Hf(1) bond lengths are 4.25 Ã…."

è¿‡æ»¤å:
"Ba(1) is bonded to six equivalent Ba(1) and three equivalent Hf(1) atoms."

âœ… åªä¿ç•™è¿æ¥æ€§ä¿¡æ¯ï¼Œå»é™¤æ‰€æœ‰é”®é•¿
```

### æ¨¡å¼ B: Moderate (ä¸­ç­‰)
**å»é™¤**: é”®é•¿é”®è§’å¥å­ï¼Œä¿ç•™é…ä½æè¿°

```
åŸå§‹:
"Li(1) is bonded in a 12-coordinate geometry to atoms. All Li(1)-Ba(1)
bond lengths are 4.31 Ã…."

è¿‡æ»¤å:
"Li(1) is bonded in a 12-coordinate geometry to atoms."

âœ… ä¿ç•™"12-coordinate geometry"ï¼Œå»é™¤é”®é•¿
```

### æ¨¡å¼ C: Conservative (ä¿å®ˆ)
**å»é™¤**: åªæ›¿æ¢æ•°å€¼æœ¬èº«ä¸ºå ä½ç¬¦

```
åŸå§‹:
"All Ba(1)-Hf(1) bond lengths are 4.25 Ã…."

è¿‡æ»¤å:
"All Ba(1)-Hf(1) bond lengths are X Ã…."

âœ… ä¿ç•™å¥å­ç»“æ„ï¼Œéšè—å…·ä½“æ•°å€¼
```

---

## ğŸ”¬ å®é™…ç¤ºä¾‹å¯¹æ¯”

### ç¤ºä¾‹ 1: Ba4LiHf (å…¨æ¨¡æ€æ¨¡å‹çš„ä¾‹å­)

#### åŸå§‹æè¿° (405 å­—ç¬¦):
```
LiBa4Hf crystallizes in the cubic F-43m space group. The structure consists
of four Li clusters inside a Ba4Hf framework. In each Li cluster, Li(1) is
bonded in a 12-coordinate geometry to atoms. In the Ba4Hf framework, Ba(1)
is bonded in a distorted q6 geometry to six equivalent Ba(1) and three
equivalent Hf(1) atoms. There are three shorter (3.60 Ã…) and three longer
(3.66 Ã…) Ba(1)-Ba(1) bond lengths. All Ba(1)-Hf(1) bond lengths are 4.25 Ã….
Hf(1) is bonded in a 12-coordinate geometry to twelve equivalent Ba(1) atoms.
```

#### Aggressive è¿‡æ»¤å (256 å­—ç¬¦, -37%):
```
LiBa4Hf crystallizes in the cubic F-43m space group. The structure consists
of four Li clusters inside a Ba4Hf framework. In each Li cluster, Li(1) is
bonded in a 12-coordinate geometry to atoms. In the Ba4Hf framework, Ba(1)
is bonded in a distorted q6 geometry to six equivalent Ba(1) and three
equivalent Hf(1) atoms. Hf(1) is bonded in a 12-coordinate geometry to
twelve equivalent Ba(1) atoms.
```

#### çº¯å…¨å±€æ‘˜è¦ (92 å­—ç¬¦, -77%):
```
LiBa4Hf crystallizes in cubic system space group F-43m.
```

---

### ç¤ºä¾‹ 2: AlAs

#### åŸå§‹æè¿°:
```
AlAs is Zincblende, Sphalerite structured and crystallizes in the cubic
F-43m space group. Al(1) is bonded to four equivalent As(1) atoms to form
corner-sharing AlAs4 tetrahedra. All Al(1)-As(1) bond lengths are 2.48 Ã….
As(1) is bonded to four equivalent Al(1) atoms to form corner-sharing
AsAl4 tetrahedra.
```

#### Aggressive è¿‡æ»¤å:
```
AlAs is Zincblende, Sphalerite structured and crystallizes in the cubic
F-43m space group. Al(1) is bonded to four equivalent As(1) atoms to form
corner-sharing AlAs4 tetrahedra. As(1) is bonded to four equivalent Al(1)
atoms to form corner-sharing AsAl4 tetrahedra.
```

#### çº¯å…¨å±€æ‘˜è¦:
```
AlAs has Zincblende, Sphalerite structure crystallizes in cubic system
space group F-43m.
```

**åˆ†æ**:
- âœ… ä¿ç•™: "Zincblende", "cubic F-43m", "corner-sharing tetrahedra"
- âŒ å»é™¤: "2.48 Ã…"

---

### ç¤ºä¾‹ 3: FeOF (å¤æ‚ç»“æ„)

#### åŸå§‹æè¿° (å¾ˆé•¿ï¼ŒåŒ…å«å¤§é‡é”®é•¿ä¿¡æ¯):
```
FeOF is beta Vanadium nitride-derived structured and crystallizes in the
trigonal R3 space group. There are three inequivalent Fe sites. In the
first Fe site, Fe(1) is bonded to three equivalent O(1) and three equivalent
F(1) atoms to form a mixture of corner and face-sharing FeO3F3 octahedra.
The corner-sharing octahedral tilt angles range from 40-54Â°. All Fe(1)-O(1)
bond lengths are 1.93 Ã…. All Fe(1)-F(1) bond lengths are 2.17 Ã…. ...
```

#### Aggressive è¿‡æ»¤å (å‡å°‘ ~50%):
```
FeOF is beta Vanadium nitride-derived structured and crystallizes in the
trigonal R3 space group. There are three inequivalent Fe sites. In the
first Fe site, Fe(1) is bonded to three equivalent O(1) and three equivalent
F(1) atoms to form a mixture of corner and face-sharing FeO3F3 octahedra.
In the second Fe site, Fe(2) is bonded to three equivalent O(1) and three
equivalent F(1) atoms to form a mixture of face, corner, and edge-sharing
FeO3F3 octahedra. ...
```

#### çº¯å…¨å±€æ‘˜è¦:
```
FeOF has beta Vanadium nitride-derived structure crystallizes in trigonal
system space group R3.
```

**åˆ†æ**:
- âœ… ä¿ç•™: "beta Vanadium nitride-derived", "trigonal R3", "octahedra"
- âŒ å»é™¤: "1.93 Ã…", "2.17 Ã…", "40-54Â°"

---

## ğŸ“ˆ è¿‡æ»¤æ•ˆæœç»Ÿè®¡

åŸºäºæ‚¨æä¾›çš„11ä¸ªææ–™æ ·æœ¬ï¼š

| ææ–™ | åŸå§‹é•¿åº¦ | Aggressive | Moderate | Conservative | å…¨å±€æ‘˜è¦ | å‹ç¼©ç‡ |
|------|---------|-----------|----------|-------------|---------|--------|
| Ba4NaBi | 482 | ~320 | ~340 | ~450 | ~85 | 34% |
| FeOF | 982 | ~510 | ~550 | ~920 | ~95 | 48% |
| AlAs | 298 | ~230 | ~245 | ~280 | ~88 | 23% |
| SrB6 | 256 | ~180 | ~195 | ~240 | ~82 | 30% |
| SiS | 312 | ~210 | ~230 | ~290 | ~75 | 33% |
| NaI | 298 | ~210 | ~225 | ~280 | ~78 | 30% |

**å¹³å‡å‹ç¼©ç‡**:
- Aggressive: ~35%
- Moderate: ~28%
- Conservative: ~10%
- å…¨å±€æ‘˜è¦: ~75%

---

## ğŸ¨ å¯è§†åŒ–ï¼šæ³¨æ„åŠ›å˜åŒ–

### ä½¿ç”¨åŸå§‹æè¿° (å«å±€éƒ¨ä¿¡æ¯):

```
Ba åŸå­çš„ Top Words:
1. liba4hf     0.375
2. 4.25        0.145  â† æ— å…³æ•°å€¼è·å¾—é«˜æ³¨æ„åŠ›ï¼
3. Ã¥           0.132  â† å•ä½ç¬¦å·è·å¾—é«˜æ³¨æ„åŠ›ï¼
4. ba(1)       0.125
5. 3.60        0.089  â† å¦ä¸€ä¸ªæ— å…³æ•°å€¼
```

### ä½¿ç”¨è¿‡æ»¤åæè¿° (æ— å±€éƒ¨ä¿¡æ¯):

```
Ba åŸå­çš„ Top Words:
1. liba4hf     0.395  â† æƒé‡æå‡
2. cubic       0.168  â† å…¨å±€ç‰¹å¾
3. ba(1)       0.142
4. framework   0.098  â† åŠå…¨å±€ç‰¹å¾
5. f-43m       0.067  â† ç©ºé—´ç¾¤
```

**æ•ˆæœ**: æ³¨æ„åŠ›ä»æ— å…³æ•°å€¼è½¬ç§»åˆ°æœ‰æ„ä¹‰çš„ç»“æ„å…³é”®è¯ï¼

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³• 1: å¤„ç†å•ä¸ªæè¿°

```python
from filter_global_information import remove_local_information

original = "Your material description here..."

# Aggressive æ¨¡å¼
filtered = remove_local_information(original, mode='aggressive')

print("åŸå§‹:", original)
print("è¿‡æ»¤:", filtered)
```

### æ–¹æ³• 2: å¤„ç†æ•´ä¸ª CSV æ–‡ä»¶

```python
from filter_global_information import process_descriptions

# å¤„ç†æ‚¨çš„æ•°æ®æ–‡ä»¶
df = process_descriptions(
    csv_file='desc_mbj_bandgap0.csv',
    output_file='desc_mbj_bandgap0_filtered.csv',
    mode='aggressive',
    include_global_summary=True
)
```

è¾“å‡ºCSVåŒ…å«ï¼š
- `description`: åŸå§‹æè¿°
- `description_filtered`: è¿‡æ»¤åæè¿°
- `global_summary`: çº¯å…¨å±€æ‘˜è¦

### æ–¹æ³• 3: æ‰¹é‡å¤„ç†ä¸‰ç§æ¨¡å¼

```bash
python filter_global_information.py
```

ä¼šç”Ÿæˆï¼š
- `desc_mbj_bandgap0_aggressive.csv`
- `desc_mbj_bandgap0_moderate.csv`
- `desc_mbj_bandgap0_conservative.csv`

---

## ğŸ’¡ æ¨èé…ç½®

### å¯¹äºç»†ç²’åº¦æ³¨æ„åŠ›å¯è§£é‡Šæ€§åˆ†æ

**æ¨è**: Aggressive æ¨¡å¼ + Middle Fusion

**åŸå› **:
1. **Aggressiveè¿‡æ»¤** å»é™¤é”®é•¿ã€é”®è§’ç­‰å±€éƒ¨ç»†èŠ‚
2. **Middle Fusion** è¿‡æ»¤åŠŸèƒ½è¯ï¼ˆthe, in, aï¼‰
3. **åŒé‡è¿‡æ»¤** â†’ åªå…³æ³¨çœŸæ­£é‡è¦çš„ç»“æ„å…³é”®è¯

**ç¤ºä¾‹å·¥ä½œæµ**:

```bash
# æ­¥éª¤ 1: è¿‡æ»¤å±€éƒ¨ä¿¡æ¯
python filter_global_information.py

# æ­¥éª¤ 2: ä½¿ç”¨è¿‡æ»¤åçš„æè¿°è®­ç»ƒæ¨¡å‹
# åœ¨æ•°æ®åŠ è½½æ—¶ä½¿ç”¨ description_filtered åˆ—

# æ­¥éª¤ 3: åˆ†ææ³¨æ„åŠ›
python demo_robust_attention.py \
    --model_path model_filtered_desc.pt \
    --cif_path structure.cif \
    --text "filtered description"
```

### å¯¹äºä¸åŒç ”ç©¶ç›®æ ‡

| ç ”ç©¶ç›®æ ‡ | æ¨èæ¨¡å¼ | åŸå›  |
|---------|---------|------|
| **å¯è§£é‡Šæ€§åˆ†æ** | Aggressive | æœ€å¤§åŒ–å…¨å±€ä¿¡æ¯ |
| **æ€§èƒ½ä¼˜åŒ–** | Moderate | å¹³è¡¡ä¿¡æ¯é‡å’Œå™ªéŸ³ |
| **åŸºå‡†å¯¹æ¯”** | Conservative | ä¿æŒç»“æ„ä¸€è‡´æ€§ |
| **å¿«é€ŸåŸå‹** | å…¨å±€æ‘˜è¦ | æœ€å°åŒ–è¾“å…¥é•¿åº¦ |

---

## ğŸ“Š æ•ˆæœéªŒè¯

### éªŒè¯æ–¹æ³• 1: æ³¨æ„åŠ›ç†µå¯¹æ¯”

```python
# ä½¿ç”¨åŸå§‹æè¿°
entropy_original = 3.59

# ä½¿ç”¨è¿‡æ»¤æè¿°
entropy_filtered = 2.15

# ç»“æœ: ç†µé™ä½ 40% â†’ æ³¨æ„åŠ›æ›´é›†ä¸­åœ¨æœ‰æ„ä¹‰çš„è¯ä¸Š
```

### éªŒè¯æ–¹æ³• 2: Top Words è´¨é‡

**åŸå§‹æè¿°çš„ Top Words**:
- åŒ…å«æ•°å€¼: "2.48", "4.25", "3.60"
- åŒ…å«å•ä½: "Ã…", "Â°"

**è¿‡æ»¤æè¿°çš„ Top Words**:
- åªæœ‰å…³é”®è¯: "liba4hf", "cubic", "framework", "f-43m"

### éªŒè¯æ–¹æ³• 3: æ¨¡å‹æ€§èƒ½

é¢„æœŸæ•ˆæœï¼š
- âœ… æ³¨æ„åŠ›è´¨é‡æå‡
- âœ… å¯è§£é‡Šæ€§å¢å¼º
- âš ï¸ é¢„æµ‹æ€§èƒ½å¯èƒ½ç•¥æœ‰å˜åŒ–ï¼ˆå› ä¸ºä¿¡æ¯å‡å°‘ï¼‰

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. ä¿¡æ¯æŸå¤±

**Aggressive æ¨¡å¼ä¼šä¸¢å¤±**:
- é”®é•¿ä¿¡æ¯ â†’ æ— æ³•åŒºåˆ†å¼ºé”®/å¼±é”®
- é”®è§’ä¿¡æ¯ â†’ æ— æ³•åˆ¤æ–­æ‰­æ›²ç¨‹åº¦
- å…·ä½“é…ä½æ•° â†’ åªæœ‰"å‡ ä½•"æè¿°

**æƒè¡¡**: å¯è§£é‡Šæ€§ â†‘, ä¿¡æ¯å®Œæ•´æ€§ â†“

### 2. ä¸é€‚ç”¨åœºæ™¯

**ä¸å»ºè®®è¿‡æ»¤**çš„æƒ…å†µ:
- éœ€è¦é¢„æµ‹é”®é•¿ç›¸å…³æ€§è´¨ï¼ˆå¼¹æ€§æ¨¡é‡ç­‰ï¼‰
- ç ”ç©¶å±€éƒ¨ç»“æ„-æ€§è´¨å…³ç³»
- éœ€è¦å®Œæ•´ä¿¡æ¯çš„ä¸‹æ¸¸ä»»åŠ¡

### 3. ä¸Middle Fusionçš„é…åˆ

**æœ€ä½³å®è·µ**:
```
æ•°æ®å‡†å¤‡: è¿‡æ»¤å±€éƒ¨ä¿¡æ¯ï¼ˆæœ¬è„šæœ¬ï¼‰
    â†“
æ¨¡å‹è®­ç»ƒ: ä½¿ç”¨ Middle Fusionï¼ˆè¿‡æ»¤åŠŸèƒ½è¯ï¼‰
    â†“
æ³¨æ„åŠ›åˆ†æ: æ¸…æ™°çš„ã€æœ‰æ„ä¹‰çš„æ³¨æ„åŠ›æ¨¡å¼
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `filter_global_information.py` - è¿‡æ»¤è„šæœ¬ï¼ˆæœ¬æ–‡æ¡£å¯¹åº”ï¼‰
- `MIDDLE_FUSION_COMPARISON.md` - Middle Fusionå¯¹æ¯”åˆ†æ
- `demo_robust_attention.py` - æ³¨æ„åŠ›å¯è§†åŒ–å·¥å…·

---

## ğŸ¯ æ€»ç»“

### æ ¸å¿ƒæ€æƒ³

**é—®é¢˜**: ææ–™æè¿°åŒ…å«å¤§é‡å±€éƒ¨ç»†èŠ‚ï¼ˆé”®é•¿ã€é”®è§’ï¼‰ï¼Œè¿™äº›æ•°å€¼å¯èƒ½:
1. åˆ†æ•£æ³¨æ„åŠ›æœºåˆ¶çš„ç„¦ç‚¹
2. è·å¾—ä¸åº”æœ‰çš„æ³¨æ„åŠ›æƒé‡
3. é™ä½å¯è§£é‡Šæ€§åˆ†æçš„è´¨é‡

**è§£å†³æ–¹æ¡ˆ**: è¿‡æ»¤å±€éƒ¨ä¿¡æ¯ï¼Œåªä¿ç•™å…¨å±€å’ŒåŠå…¨å±€ç‰¹å¾

**æ•ˆæœ**:
- âœ… æ³¨æ„åŠ›æ›´é›†ä¸­åœ¨ç»“æ„å…³é”®è¯
- âœ… å¯è§£é‡Šæ€§åˆ†ææ›´æ¸…æ™°
- âœ… ä¸Middle FusionååŒæ•ˆæœæ›´å¥½

### å¿«é€Ÿå¼€å§‹

```bash
# è¿è¡Œè„šæœ¬
python filter_global_information.py

# æ£€æŸ¥è¾“å‡º
head desc_mbj_bandgap0_aggressive.csv

# ä½¿ç”¨è¿‡æ»¤åçš„æ•°æ®è®­ç»ƒ/åˆ†ææ¨¡å‹
```

**å»ºè®®**: ä» Aggressive æ¨¡å¼å¼€å§‹ï¼Œè§‚å¯Ÿæ•ˆæœåå†è°ƒæ•´ï¼
