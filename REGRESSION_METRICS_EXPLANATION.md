# 回归指标说明 (Regression Metrics Comparison)

`compare_fusion_mechanisms.py` 生成的 `regression_metrics_comparison.png` 表格包含以下指标，用于评估不同融合阶段特征的质量：

## 指标详解

### 1. **Avg Pearson Corr** (平均皮尔逊相关系数)
- **计算方式**：计算每个特征维度与目标值的皮尔逊相关系数，然后取绝对值的平均
- **取值范围**：0 到 1
- **含义**：衡量特征与目标之间的**线性相关性**强度
- **越高越好**：
  - **0.3-0.5**: 中等相关性
  - **> 0.5**: 强相关性
- **作用**：反映特征对预测任务的**平均贡献能力**
- **示例**：
  ```
  如果 Avg Pearson Corr = 0.45
  → 特征维度平均与目标值有中等程度的线性关系
  → 这些特征对回归预测有一定帮助
  ```

### 2. **Max Pearson Corr** (最大皮尔逊相关系数)
- **计算方式**：所有特征维度中，与目标值相关性最高的那一个维度的相关系数
- **取值范围**：0 到 1
- **含义**：特征中**最有用的那个维度**与目标的相关性
- **越高越好**：
  - **> 0.6**: 存在强相关的关键特征
- **作用**：识别特征是否包含**高度预测性的维度**
- **示例**：
  ```
  如果 Max Pearson Corr = 0.75
  → 至少有一个特征维度与目标高度相关
  → 模型可能主要依赖这个维度进行预测
  ```

### 3. **Avg Spearman Corr** (平均斯皮尔曼相关系数)
- **计算方式**：计算每个特征维度与目标值的斯皮尔曼秩相关系数，然后取绝对值的平均
- **取值范围**：0 到 1
- **含义**：衡量特征与目标之间的**单调关系**（不一定是线性）
- **越高越好**：
  - **> 0.3**: 中等单调关系
  - **> 0.5**: 强单调关系
- **与 Pearson 的区别**：
  - **Pearson**: 线性相关（y = ax + b）
  - **Spearman**: 单调相关（y 随 x 单调增/减，但不一定是直线）
- **作用**：检测**非线性但单调**的特征-目标关系
- **示例**：
  ```
  如果 Spearman > Pearson
  → 特征与目标存在非线性的单调关系
  → 可能需要非线性模型来更好地利用这些特征
  ```

### 4. **Feature Variance** (特征方差)
- **计算方式**：计算每个特征维度在所有样本上的方差，然后取平均
- **取值范围**：≥ 0
- **含义**：特征的**变化范围**和**表达能力**
- **不是越高越好**：
  - **过低** (接近 0): 特征几乎不变，无信息量
  - **适中**: 特征有区分度，能捕获样本差异
  - **过高**: 可能存在异常值或尺度问题
- **作用**：
  - 评估特征是否有足够的**表达能力**
  - 检测特征是否**坍缩**（所有值都相同）
- **示例**：
  ```
  如果 Feature Variance = 0.001
  → 特征值变化很小
  → 可能无法区分不同样本

  如果 Feature Variance = 10.0
  → 特征值变化范围大
  → 有较强的表达能力
  ```

### 5. **Feature Std** (特征标准差)
- **计算方式**：计算每个特征维度的标准差，然后取平均
- **取值范围**：≥ 0
- **含义**：方差的平方根，与方差含义相同但尺度更直观
- **作用**：与 Feature Variance 类似，用于评估特征的离散程度
- **关系**：`Feature Std = sqrt(Feature Variance)`

### 6. **Feature Norm** (特征范数)
- **计算方式**：计算每个样本特征向量的 L2 范数（欧几里得距离），然后取平均
- **取值范围**：≥ 0
- **含义**：特征向量的**平均长度/幅度**
- **作用**：
  - 衡量特征的**整体尺度**
  - 检测特征是否被**过度放大或缩小**
  - 对比不同阶段的特征尺度变化
- **示例**：
  ```
  如果 graph_base 的 Norm = 5.0
  而 graph_cross 的 Norm = 15.0
  → 跨模态注意力将特征幅度放大了 3 倍
  → 可能增强了特征的表达能力
  ```

## 指标对比表

### 不同融合阶段的典型模式

| 特征阶段 | Avg Pearson | Max Pearson | Avg Spearman | Variance | 解释 |
|---------|------------|------------|--------------|----------|------|
| **graph_base** | 0.25 | 0.45 | 0.30 | 2.5 | 基础图特征，相关性一般 |
| **graph_middle** | 0.32 | 0.55 | 0.38 | 3.2 | 中期融合增强了相关性 |
| **graph_fine** | 0.40 | 0.65 | 0.45 | 4.1 | 细粒度注意力显著提升 |
| **graph_cross** | 0.48 | 0.72 | 0.52 | 5.0 | 全局注意力进一步优化 |
| **fused** | 0.52 | 0.78 | 0.56 | 6.5 | 融合特征效果最佳 |

### 理想的特征应该：
1. ✅ **高相关性**: Avg Pearson > 0.3, Max Pearson > 0.5
2. ✅ **单调关系**: Avg Spearman 接近或高于 Pearson
3. ✅ **适中方差**: 既有区分度，又不会过大
4. ✅ **渐进提升**: 后续融合阶段的指标逐步提高

## 如何解读结果

### 场景 1: 融合有效
```
graph_base:   Avg Pearson = 0.25
graph_middle: Avg Pearson = 0.35  ← 提升 40%
graph_fine:   Avg Pearson = 0.45  ← 再提升 29%
graph_cross:  Avg Pearson = 0.50  ← 再提升 11%
```
**结论**: 每个融合阶段都在提升特征质量，融合机制有效！

### 场景 2: 中期融合效果不明显
```
graph_base:   Avg Pearson = 0.30
graph_middle: Avg Pearson = 0.32  ← 仅提升 7%
graph_fine:   Avg Pearson = 0.48  ← 大幅提升 50%
```
**结论**: 中期融合作用有限，细粒度注意力才是关键。

### 场景 3: 特征坍缩
```
graph_fine:   Variance = 5.2
graph_cross:  Variance = 0.8  ← 大幅下降
              Avg Pearson = 0.15  ← 相关性也降低
```
**结论**: 全局注意力可能导致特征坍缩，需要调整参数。

### 场景 4: 非线性关系占主导
```
graph_fine:   Avg Pearson = 0.25
              Avg Spearman = 0.45  ← 高于 Pearson
```
**结论**: 特征与目标存在非线性单调关系，可以考虑使用非线性回归模型。

## 实际应用建议

1. **优先看相关性指标** (Pearson/Spearman)
   - 直接反映特征对预测任务的有用性
   - 对比不同阶段，选择相关性最高的

2. **关注方差变化**
   - 如果方差突然降低 → 可能过拟合或特征坍缩
   - 如果方差逐步增加 → 特征表达能力在增强

3. **Pearson vs Spearman**
   - 如果两者接近 → 线性关系为主
   - 如果 Spearman 明显更高 → 存在非线性关系

4. **Max Pearson 的价值**
   - 识别是否存在"关键维度"
   - 如果 Max >> Avg → 特征中有少数维度特别重要

## 可视化图表说明

`regression_metrics_comparison.png` 包含 4 个子图：

1. **左上**: Avg Pearson Corr - 平均线性相关性
2. **右上**: Max Pearson Corr - 最大线性相关性
3. **左下**: Avg Spearman Corr - 平均单调相关性
4. **右下**: Feature Variance - 特征方差

每个子图会用不同颜色的柱状图显示各个特征阶段的指标值，并标注参考线（0.3 和 0.5）。

## 与分类任务指标的区别

`regression_metrics_comparison.png` 专门用于**回归任务**，评估特征对连续值预测的质量。

如果是**分类任务**，应该看 `metrics_comparison.png`，包含：
- Silhouette Score（轮廓系数）
- Davies-Bouldin Index（戴维森堡丁指数）
- Intra-class Similarity（类内相似度）
- Inter-class Separation（类间分离度）
